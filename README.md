# テニスサーブ分析システム

## プロジェクト概要
このプロジェクトは、テニスのサーブ動作を分析し、選手のパフォーマンスを定量的に評価するシステムです。ビデオ入力を使用して、サーブ動作中の主要な身体の動き、特に肘と膝の角度変化を追跡し、サーブのフェーズを分類します。また、分析結果を視覚化し、詳細なレポートを生成します。

## モジュール詳細

### 1. main.py
メインスクリプトで、全体の処理フローを制御します。
- 設定ファイル（config.yaml）の読み込み
- TensorFlow Hubのセットアップ
- ビデオ処理の実行
- フェーズ分類の実行
- 結果の可視化
- レポートの生成

### 2. video_processor.py
ビデオ処理を担当するモジュールです。
- MoveNetモデルを使用したキーポイント抽出
- ビデオフレームの処理
- 骨格のオーバーレイ
- フェーズ情報のオーバーレイ
- 動的クロップ領域の決定と適用

### 3. phase_classifier.py
サーブのフェーズを分類するモジュールです。
- 動的なフェーズ境界の検出
- フェーズのスムージング

### 4. visualizer.py
結果を可視化するモジュールです。
- 関節角度の時系列プロット
- フェーズごとの背景色付け

### 5. report_generator.py
分析レポートを生成するモジュールです。
- HTML形式のレポート生成
- フェーズごとの統計情報の表示
- 視覚化結果の埋め込み

### 6. utils.py
ユーティリティ関数を含むモジュールです。
- 角度計算関数
- データスムージング関数
- 外れ値除去関数

### 7. constants.py
定数を定義するモジュールです。
- キーポイントの定義
- フェーズごとの色定義

## 主要な分析項目
1. サーブフェーズの分類 (Preparation, Backswing, Loading, Forward Swing, Impact, Follow Through)
2. 各フェーズにおける右肘の角度変化
3. 各フェーズにおける右膝の角度変化
4. 骨格のトラッキングと可視化

## 使用技術
- Python 3.7+
- TensorFlow 2.x
- OpenCV
- NumPy
- Matplotlib
- SciPy
- TensorFlow Hub (MoveNet モデル)

## 主要な分析方法

### 1. フェーズ分類
キーポイントデータから動的にフェーズ境界を検出し、初期フェーズ分類を行います。その後、メディアンフィルタを使用してフェーズをスムージングします。

### 2. 関節角度の計算
右肩、右肘、右手首のキーポイントを使用して肘の角度を計算し、右腰、右膝、右足首のキーポイントを使用して膝の角度を計算します。

### 3. 骨格トラッキング
MoveNetモデルを使用して、各フレームでの骨格のキーポイントを抽出します。動的クロップ領域を適用することで、選手の動きに合わせて適切な領域を分析します。

### 4. 視覚化
- 元のビデオに骨格とフェーズ情報をオーバーレイした動画を生成
- 関節角度の変化をフェーズごとに色分けしたグラフを作成

## 使用方法
1. 必要なライブラリをインストール: `pip install -r requirements.txt`
2. `config.yaml` ファイルで分析するビデオのパスを設定
3. `python main.py` を実行
4. 結果は `focused_serve_analysis_report.html` に保存され、`joint_angles.png` と処理済みビデオも生成されます

## 現在の改善点と今後の展望

1. フェーズ検出の精度向上:
   - Impact フェーズと Follow Through フェーズの検出精度を改善
   - Loading と Forward Swing フェーズの境界をより適切に設定

2. 角度計算の精度向上:
   - 外れ値の検出と除去方法の改善
   - スムージングアルゴリズムの最適化

3. 骨格トラッキングの安定性向上:
   - 動的クロップ領域の調整アルゴリズムの改良
   - オクルージョン（体の一部が隠れる状況）への対応強化

4. パフォーマンス分析の拡張:
   - サーブの速度推定機能の追加
   - 左右の非対称性の分析

5. ユーザーインターフェースの改善:
   - 対話的な分析ツールの開発
   - リアルタイム分析機能の実装

6. データセットの拡大:
   - 様々なスキルレベルの選手のサーブ動画を収集
   - 機械学習モデルの訓練に使用し、分析精度を向上
